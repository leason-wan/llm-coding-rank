<!DOCTYPE html>
<html lang="zh-CN" style="height:100%;user-select:none;">
<head>
<meta charset="UTF-8" />
<title>Flappy Bird (纯HTML版)</title>
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
        display:flex;
        justify-content:center;
        align-items:center;
        height:100%;
        background:#70c5ce;
        font-family:Arial,Helvetica,sans-serif;
    }
    #gameCanvas{
        border:2px solid #000;
        background:#70c5ce;
    }
</style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
/* ===== 基础 ===== */
const canvas = document.getElementById("gameCanvas");
const ctx      = canvas.getContext("2d");
const W        = canvas.width;
const H        = canvas.height;

/* ===== 配置 ===== */
const GRAVITY       = 0.5;
const FLAP          = -8;      // 点击后获得的向上速度
const PIPE_WIDTH    = 60;
const PIPE_GAP      = 140;
const PIPE_SPEED    = 2;
const PIPE_INTERVAL = 90;      // 每多少帧出现一组新管子

let gameOver = false;
let frameCount = 0;
let score = 0;

/* ===== 小鸟 ===== */
const bird = {
    x: 50,
    y: 200,
    w: 34,
    h: 24,
    vel: 0,
    draw() {
        ctx.fillStyle = "#FFE500";
        ctx.fillRect(this.x, this.y, this.w, this.h);
        // “眼睛” 不重要，用简单方块即可
    },
    update() {
        if(gameOver) return;
        this.vel += GRAVITY;
        this.y += this.vel;
        // 碰地面或天花板
        if(this.y + this.h >= H || this.y <= 0){
            endGame();
        }
    },
    flap() {
        if(!gameOver){
            this.vel = FLAP;
        }
    }
};

/* ===== 管子类 ===== */
class Pipe{
    constructor(){
        this.top = Math.floor(Math.random()*(H-PIPE_GAP-100))+20;
        this.bottom = this.top + PIPE_GAP;
        this.x = W;
        this.scored = false;
    }
    update(){
        if(gameOver) return;
        this.x -= PIPE_SPEED;
    }
    draw(){
        ctx.fillStyle = "#73BF2E";
        ctx.fillRect(this.x, 0, PIPE_WIDTH, this.top);               // 上半管
        ctx.fillRect(this.x, this.bottom, PIPE_WIDTH, H-this.bottom); // 下半管
    }
    offscreen(){
        return this.x + PIPE_WIDTH < 0;
    }
    collision(b){
        return (
            b.x + b.w > this.x && b.x < this.x + PIPE_WIDTH &&
            (b.y < this.top || b.y + b.h > this.bottom)
        );
    }
}

/* ===== 管子管理 ===== */
let pipes = [];

function managePipes(){
    if(frameCount % PIPE_INTERVAL === 0 && !gameOver){
        pipes.push(new Pipe());
    }
    pipes.forEach(p=>{
        p.update();
        if(!p.scored && p.x + PIPE_WIDTH < bird.x){
            p.scored = true;
            score++;
        }
        if(p.collision(bird)){
            endGame();
        }
    });
    pipes = pipes.filter(p=>!p.offscreen());
}

/* ===== 渲染文本 ===== */
function drawText(){
    ctx.fillStyle = "#fff";
    ctx.font = "40px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(score, W/2, 80);

    if(gameOver){
        ctx.fillText("点击或按空格重开", W/2, H/2 + 50);
    }
}

/* ===== 结束游戏 ===== */
function endGame(){
    gameOver = true;
}

/* ===== 重置游戏 ===== */
function resetGame(){
    gameOver = false;
    frameCount = 0;
    score = 0;
    bird.y = 200;
    bird.vel = 0;
    pipes = [];
}

/* ===== 用户输入 ===== */
window.addEventListener("keydown", e=>{
    if(e.code === "Space"){
        e.preventDefault();
        if(gameOver){
            resetGame();
        }else{
            bird.flap();
        }
    }
});
canvas.addEventListener("mousedown", ()=>{
    if(gameOver){
        resetGame();
    }else{
        bird.flap();
    }
});

/* ===== 主循环 ===== */
function gameLoop(){
    ctx.clearRect(0,0,W,H);
    frameCount++;

    // 背景
    ctx.fillStyle = "#70c5ce";
    ctx.fillRect(0,0,W,H);

    bird.update();
    bird.draw();

    managePipes();
    pipes.forEach(p=>p.draw());

    drawText();

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>